<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Hospital episode examples • NHSRepisodes</title>
<script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Hospital episode examples">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">NHSRepisodes</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="../articles/NHSRepisodes.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Hospital episode examples</h1>
            
      

      <div class="d-none name"><code>NHSRepisodes.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://nhs-r-community.github.io/NHSRepisodes/">NHSRepisodes</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="terminology">Terminology<a class="anchor" aria-label="anchor" href="#terminology"></a>
</h2>
<div class="section level3">
<h3 id="stays">Stays<a class="anchor" aria-label="anchor" href="#stays"></a>
</h3>
<p>Hospitals may record data according to <code>bed stays</code>,
<code>ward stays</code> and <code>in-patient stays</code> (or episode)
as it is used to record how people move around the hospital.</p>
</div>
<div class="section level3">
<h3 id="entering-and-leaving-hospital">Entering and leaving hospital<a class="anchor" aria-label="anchor" href="#entering-and-leaving-hospital"></a>
</h3>
<p>A patient will <code>attend</code> something like Accident and
Emergency - A&amp;E (also known as Emergency Department or as the
acronym ED) and if they stay in hospital that becomes an
<code>admission</code>. Leaving a hospital from its service (because
this can also occur with outpatients where a person isn’t admitted to
stay for any period) is called <code>discharge</code>.</p>
</div>
<div class="section level3">
<h3 id="journey-as-recorded-in-data">Journey as recorded in data<a class="anchor" aria-label="anchor" href="#journey-as-recorded-in-data"></a>
</h3>
<p>Patients can be moved from <code>beds</code> in a <code>ward</code>,
moved between <code>wards</code> in a <code>hospital</code> and have an
overall <code>in-patient stay</code> which is how long they were in a
hospital.</p>
</div>
<div class="section level3">
<h3 id="out-of-area">Out of area<a class="anchor" aria-label="anchor" href="#out-of-area"></a>
</h3>
<p>Some services, like those for mental health, may record a move to
another hospital and in the case of mental health will record this as
<code>out of area</code>. Even with all these “stays” the actual time a
patient is in the service, or commissioned as part of the service, could
all count as one and, if records are from different systems, may either
overlap or not join together.</p>
<p>For example, if a mental health patient is in a local service, then
moves, a gap of a day or two is most likely to be an administrative
error. An example of this delay could be because a patient is moved from
one hospital on the Sunday but the recording takes place on the Monday
or even the Tuesday if the Monday is a public holiday. In order to
record the move the patient will be <code>discharged</code> although, in
actuality they are still in healthcare services.</p>
</div>
</div>
<div class="section level2">
<h2 id="using-nhsrepisodes">Using NHSRepisodes<a class="anchor" aria-label="anchor" href="#using-nhsrepisodes"></a>
</h2>
<p>It may be that an analyst has access to all the data related to a
stay in hospital, so beds, ward, overall stay in something like a SQL
warehouse and in that case it’s very likely that the dates are
reasonably accurate. However, if there is any overlapping in any of the
data this will affect overall counts because the one stay could look
like two or more entries. It could also affect counts by days to see
<code>bed occupancy</code> as one person could appear twice and so be
double counted.</p>
<p>There will be many ways around these issues of double counting but
the package NHSRepisodes has quick and efficient functions in R that can
change or add a column of information on the <code>episodes</code> to
your data.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://nhs-r-community.github.io/NHSRepisodes/">NHSRepisodes</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">services</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html" class="external-link">tribble</a></span><span class="op">(</span></span>
<span>  <span class="op">~</span><span class="va">code</span>, <span class="op">~</span><span class="va">service</span>, <span class="op">~</span><span class="va">type</span>,</span>
<span>  <span class="st">"t100"</span>, <span class="st">"service A"</span>, <span class="st">"inpatient"</span>,</span>
<span>  <span class="st">"t200"</span>, <span class="st">"service B"</span>, <span class="st">"inpatient"</span>,</span>
<span>  <span class="st">"t500"</span>, <span class="st">"service C"</span>, <span class="st">"inpatient"</span>,</span>
<span>  <span class="st">"t600"</span>, <span class="st">"service D"</span>, <span class="st">"out of area"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create a dummy data set give the first and last dates of an episode</span></span>
<span><span class="co"># using withr package to</span></span>
<span></span>
<span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html" class="external-link">tribble</a></span><span class="op">(</span></span>
<span>  <span class="op">~</span><span class="va">patient_id</span>, <span class="op">~</span><span class="va">admission</span>, <span class="op">~</span><span class="va">discharge</span>, <span class="op">~</span><span class="va">code</span>, <span class="op">~</span><span class="va">notes</span>,</span>
<span>  <span class="fl">1L</span>, <span class="st">"2020-01-01"</span>, <span class="st">"2020-01-10"</span>, <span class="st">"t100"</span>, <span class="cn">NA</span>,</span>
<span>  <span class="fl">1L</span>, <span class="st">"2020-01-12"</span>, <span class="st">"2020-01-22"</span>, <span class="st">"t600"</span>, <span class="st">"this has a gap"</span>,</span>
<span>  <span class="fl">1L</span>, <span class="st">"2020-05-01"</span>, <span class="st">"2020-10-01"</span>, <span class="st">"t100"</span>, <span class="cn">NA</span>,</span>
<span>  <span class="fl">1L</span>, <span class="st">"2020-10-01"</span>, <span class="st">"2020-11-01"</span>, <span class="st">"t600"</span>, <span class="st">"same day overlap"</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># columns must be date format to work with NHSRepisodes functions</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="va">admission</span><span class="op">:</span><span class="va">discharge</span>, <span class="va">as.Date</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">services</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">patient_id</span>, <span class="va">admission</span><span class="op">)</span></span></code></pre></div>
<p>Find the episodes and add a column to the data:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dat</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># Rename the columns so that they are recognised by the `add_parent_interval()` function</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span></span>
<span>    id <span class="op">=</span> <span class="va">patient_id</span>,</span>
<span>    start <span class="op">=</span> <span class="va">admission</span>,</span>
<span>    end <span class="op">=</span> <span class="va">discharge</span>,</span>
<span>    <span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html" class="external-link">everything</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">NHSRepisodes</span><span class="fu">::</span><span class="fu"><a href="../reference/add_parent_interval.html">add_parent_interval</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">id</span>,</span>
<span>           <span class="va">start</span>,</span>
<span>           <span class="va">end</span>,</span>
<span>           <span class="va">.parent_start</span>,</span>
<span>           <span class="va">.parent_end</span>,</span>
<span>           <span class="va">.interval_number</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 4 × 6</span></span></span>
<span><span class="co">#&gt;      id start      end        .parent_start .parent_end .interval_number</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>                 <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>     1 2020-01-01 2020-01-10 2020-01-01    2020-01-10                 1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>     1 2020-01-12 2020-01-22 2020-01-12    2020-01-22                 2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>     1 2020-05-01 2020-10-01 2020-05-01    2020-11-01                 3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>     1 2020-10-01 2020-11-01 2020-05-01    2020-11-01                 3</span></span></code></pre></div>
<p>Because this patient had a gap of a few days between and inpatient
and out of area stay this appears, currently, as two intervals
(episodes).</p>
<p>To adjust this add days to the discharge (end) column according to
what is appropriate for the data.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dat</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># Rename the columns so that they are recognised by the `add_parent_interval()` function</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span></span>
<span>    id <span class="op">=</span> <span class="va">patient_id</span>,</span>
<span>    start <span class="op">=</span> <span class="va">admission</span>,</span>
<span>    end_actual <span class="op">=</span> <span class="va">discharge</span>,</span>
<span>    <span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html" class="external-link">everything</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>end <span class="op">=</span> <span class="va">end_actual</span> <span class="op">+</span> <span class="fl">2</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">NHSRepisodes</span><span class="fu">::</span><span class="fu"><a href="../reference/add_parent_interval.html">add_parent_interval</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">id</span>,</span>
<span>           <span class="va">start</span>,</span>
<span>           <span class="va">end</span>,</span>
<span>           <span class="va">.parent_start</span>,</span>
<span>           <span class="va">.parent_end</span>,</span>
<span>           <span class="va">.interval_number</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 4 × 6</span></span></span>
<span><span class="co">#&gt;      id start      end        .parent_start .parent_end .interval_number</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>                 <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>     1 2020-01-01 2020-01-12 2020-01-01    2020-01-24                 1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>     1 2020-01-12 2020-01-24 2020-01-01    2020-01-24                 1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>     1 2020-05-01 2020-10-03 2020-05-01    2020-11-03                 2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>     1 2020-10-01 2020-11-03 2020-05-01    2020-11-03                 2</span></span></code></pre></div>
<p>Rather than adding a column to the data, it is possible to use the
function <code><a href="../reference/merge_episodes.html">merge_episodes()</a></code> to return one row for each
episode. Using the last example where days were added to the end
(discharge) to close an out of area gap:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dat</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># Rename the columns so that they are recognised by the `add_parent_interval()` function</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span></span>
<span>    id <span class="op">=</span> <span class="va">patient_id</span>,</span>
<span>    start <span class="op">=</span> <span class="va">admission</span>,</span>
<span>    end_actual <span class="op">=</span> <span class="va">discharge</span>,</span>
<span>    <span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html" class="external-link">everything</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>end <span class="op">=</span> <span class="va">end_actual</span> <span class="op">+</span> <span class="fl">2</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">NHSRepisodes</span><span class="fu">::</span><span class="fu"><a href="../reference/merge_episodes.html">merge_episodes</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2 × 4</span></span></span>
<span><span class="co">#&gt;      id .interval_number .episode_start .episode_end</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>     1                1 2020-01-01     2020-01-24  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>     1                2 2020-05-01     2020-11-03</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Zoë Turner, Tim Taylor.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
