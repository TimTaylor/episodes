<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Package Relating to Hospital Episode Intervals • NHSRepisodes</title>
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Package Relating to Hospital Episode Intervals">
<meta name="description" content="Hospital episodes can overlap or have gaps which can result in under or over counting. This package contains functions which can be used to rectify this common analytical issue in NHS data.">
<meta property="og:description" content="Hospital episodes can overlap or have gaps which can result in under or over counting. This package contains functions which can be used to rectify this common analytical issue in NHS data.">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">NHSRepisodes</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="articles/NHSRepisodes.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header"><h1 id="nhsrepisodes">NHSRepisodes<a class="anchor" aria-label="anchor" href="#nhsrepisodes"></a>
</h1></div>
<!-- badges: start -->

<div class="section level2">
<h2 id="installation-instructions">Installation instructions<a class="anchor" aria-label="anchor" href="#installation-instructions"></a>
</h2>
<p>You can install the development version of this package from GitHub with:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install.packages("remotes")</span></span>
<span><span class="fu">remotes</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"https://github.com/nhs-r-community/NHSRepisodes"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="motivation">Motivation<a class="anchor" aria-label="anchor" href="#motivation"></a>
</h2>
<p><strong><em>NHSRepisodes</em></strong> is a (hopefully) temporary solution to a small inconvenience that relates to <a href="https://cran.r-project.org/package=data.table" class="external-link">data.table</a>, <a href="https://cran.r-project.org/package=dplyr" class="external-link">dplyr</a> and <a href="https://cran.r-project.org/package=ivs" class="external-link">ivs</a>; namely that dplyr is currently <a href="https://github.com/tidyverse/dplyr/issues/5017" class="external-link">slow when working with a large number of groupings</a> and data.table <a href="https://github.com/Rdatatable/data.table/issues/4910" class="external-link">does not easily support the record class</a> on which ivs intervals are based.</p>
<p>To expand on issues consider the following small set of episode data:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://nhs-r-community.github.io/NHSRepisodes/">NHSRepisodes</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/DavisVaughan/ivs" class="external-link">ivs</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># note - we need functionality introduced in dplyr 1.1.0.</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ns-reflect.html" class="external-link">getNamespaceVersion</a></span><span class="op">(</span><span class="st">"dplyr"</span><span class="op">)</span> <span class="op">&lt;</span> <span class="st">"1.1.0"</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/warning.html" class="external-link">warning</a></span><span class="op">(</span><span class="st">"Please update dplyr to version 1.1.0 or higher to run these examples."</span><span class="op">)</span></span>
<span>    <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/knit_exit.html" class="external-link">knit_exit</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Let's note the package versions used in generating this README</span></span>
<span><span class="va">packages</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"NHSRepisodes"</span>, <span class="st">"dplyr"</span>, <span class="st">"data.table"</span>, <span class="st">"ivs"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span><span class="va">packages</span><span class="op">)</span>, version <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">packages</span>, <span class="va">getNamespaceVersion</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 4 × 2</span></span>
<span><span class="co">#&gt;   packages     version   </span></span>
<span><span class="co">#&gt;   &lt;chr&gt;        &lt;chr&gt;     </span></span>
<span><span class="co">#&gt; 1 NHSRepisodes 0.1.0.9000</span></span>
<span><span class="co">#&gt; 2 dplyr        1.1.4.9000</span></span>
<span><span class="co">#&gt; 3 data.table   1.16.0    </span></span>
<span><span class="co">#&gt; 4 ivs          0.2.0</span></span>
<span></span>
<span><span class="co"># Create a dummy data set give the first and last dates of an episode</span></span>
<span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html" class="external-link">tribble</a></span><span class="op">(</span></span>
<span>    <span class="op">~</span><span class="va">id</span>, <span class="op">~</span><span class="va">start</span>, <span class="op">~</span><span class="va">end</span>,</span>
<span>    <span class="fl">1L</span>, <span class="st">"2020-01-01"</span>, <span class="st">"2020-01-10"</span>,</span>
<span>    <span class="fl">1L</span>, <span class="st">"2020-01-03"</span>, <span class="st">"2020-01-10"</span>,</span>
<span>    <span class="fl">2L</span>, <span class="st">"2020-04-01"</span>, <span class="st">"2020-04-30"</span>,</span>
<span>    <span class="fl">2L</span>, <span class="st">"2020-04-15"</span>, <span class="st">"2020-04-16"</span>,</span>
<span>    <span class="fl">2L</span>, <span class="st">"2020-04-17"</span>, <span class="st">"2020-04-19"</span>,</span>
<span>    <span class="fl">1L</span>, <span class="st">"2020-05-01"</span>, <span class="st">"2020-10-01"</span>,</span>
<span>    <span class="fl">1L</span>, <span class="st">"2020-01-01"</span>, <span class="st">"2020-01-10"</span>,</span>
<span>    <span class="fl">1L</span>, <span class="st">"2020-01-11"</span>, <span class="st">"2020-01-12"</span>,</span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># This will create an object called dat and also open in the console</span></span>
<span><span class="op">(</span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="va">dat</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="va">start</span><span class="op">:</span><span class="va">end</span>, <span class="va">as.Date</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 8 × 3</span></span>
<span><span class="co">#&gt;      id start      end       </span></span>
<span><span class="co">#&gt;   &lt;int&gt; &lt;date&gt;     &lt;date&gt;    </span></span>
<span><span class="co">#&gt; 1     1 2020-01-01 2020-01-10</span></span>
<span><span class="co">#&gt; 2     1 2020-01-03 2020-01-10</span></span>
<span><span class="co">#&gt; 3     2 2020-04-01 2020-04-30</span></span>
<span><span class="co">#&gt; 4     2 2020-04-15 2020-04-16</span></span>
<span><span class="co">#&gt; 5     2 2020-04-17 2020-04-19</span></span>
<span><span class="co">#&gt; 6     1 2020-05-01 2020-10-01</span></span>
<span><span class="co">#&gt; 7     1 2020-01-01 2020-01-10</span></span>
<span><span class="co">#&gt; 8     1 2020-01-11 2020-01-12</span></span></code></pre></div>
<p>The {ivs} package provides an elegant way to find the minimum spanning interval across these episodes:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dat</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>interval <span class="op">=</span> <span class="fu"><a href="https://davisvaughan.github.io/ivs/reference/iv.html" class="external-link">iv</a></span><span class="op">(</span>start <span class="op">=</span> <span class="va">start</span>, end <span class="op">=</span> <span class="va">end</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/reframe.html" class="external-link">reframe</a></span><span class="op">(</span>interval <span class="op">=</span> <span class="fu"><a href="https://davisvaughan.github.io/ivs/reference/iv-groups.html" class="external-link">iv_groups</a></span><span class="op">(</span><span class="va">interval</span>, abutting <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>, .by <span class="op">=</span> <span class="va">id</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 4 × 2</span></span>
<span><span class="co">#&gt;      id                 interval</span></span>
<span><span class="co">#&gt;   &lt;int&gt;               &lt;iv&lt;date&gt;&gt;</span></span>
<span><span class="co">#&gt; 1     1 [2020-01-01, 2020-01-11)</span></span>
<span><span class="co">#&gt; 2     1 [2020-01-11, 2020-01-13)</span></span>
<span><span class="co">#&gt; 3     1 [2020-05-01, 2020-10-02)</span></span>
<span><span class="co">#&gt; 4     2 [2020-04-01, 2020-05-01)</span></span></code></pre></div>
<p>Note that {ivs} creates intervals that are <em>right-open</em> meaning they are inclusive on the left (have an opening square bracket <code>[</code>) and exclusive on the right (with a closing a rounded bracket <code>)</code>). Consequently, in our first call to <code><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate()</a></code> we added 1 to the <code>end</code> value. This ensures that the full range of dates are considered (e.g. for the first row we want to consider all days from <code>2020-01-01</code> to <code>2020-01-10</code> not only up until <code>2020-01-09</code>).</p>
<p>This works great when we only have a small number of ids to group by. However, it becomes noticeably slow for a larger number:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Creating a larger data set</span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">125000</span></span>
<span><span class="va">id2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span>, size <span class="op">=</span> <span class="va">n</span> <span class="op">*</span> <span class="fl">5</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">start2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2020-01-01"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample.int</a></span><span class="op">(</span><span class="fl">365</span>, size <span class="op">=</span> <span class="va">n</span> <span class="op">*</span> <span class="fl">5</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">end2</span> <span class="op">&lt;-</span> <span class="va">start2</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">100</span>, size <span class="op">=</span> <span class="va">n</span> <span class="op">*</span> <span class="fl">5</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># creates the object big_dat and shows the first 10 rows as a tibble in the console</span></span>
<span><span class="op">(</span><span class="va">big_dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>id <span class="op">=</span> <span class="va">id2</span>, start <span class="op">=</span> <span class="va">start2</span>, end <span class="op">=</span> <span class="va">end2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 625,000 × 3</span></span>
<span><span class="co">#&gt;       id start      end       </span></span>
<span><span class="co">#&gt;    &lt;int&gt; &lt;date&gt;     &lt;date&gt;    </span></span>
<span><span class="co">#&gt;  1 90983 2020-02-07 2020-03-18</span></span>
<span><span class="co">#&gt;  2 59640 2020-07-05 2020-08-13</span></span>
<span><span class="co">#&gt;  3 29543 2020-04-05 2020-05-28</span></span>
<span><span class="co">#&gt;  4 17962 2020-06-07 2020-07-21</span></span>
<span><span class="co">#&gt;  5 13032 2020-08-25 2020-09-08</span></span>
<span><span class="co">#&gt;  6 94348 2020-05-11 2020-06-07</span></span>
<span><span class="co">#&gt;  7  7770 2020-03-18 2020-04-03</span></span>
<span><span class="co">#&gt;  8  9570 2020-09-25 2020-12-04</span></span>
<span><span class="co">#&gt;  9 86687 2020-11-04 2021-01-09</span></span>
<span><span class="co">#&gt; 10 66213 2020-04-09 2020-04-16</span></span>
<span><span class="co">#&gt; # ℹ 624,990 more rows</span></span>
<span></span>
<span><span class="co"># checking the time to run</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span></span>
<span>    <span class="va">out_dplyr</span> <span class="op">&lt;-</span> </span>
<span>        <span class="va">big_dat</span> <span class="op">|&gt;</span></span>
<span>        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>interval <span class="op">=</span> <span class="fu"><a href="https://davisvaughan.github.io/ivs/reference/iv.html" class="external-link">iv</a></span><span class="op">(</span><span class="va">start</span>, <span class="va">end</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/reframe.html" class="external-link">reframe</a></span><span class="op">(</span>interval <span class="op">=</span> <span class="fu"><a href="https://davisvaughan.github.io/ivs/reference/iv-groups.html" class="external-link">iv_groups</a></span><span class="op">(</span><span class="va">interval</span>, abutting <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>, .by <span class="op">=</span> <span class="va">id</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt;    user  system elapsed </span></span>
<span><span class="co">#&gt;  13.870   0.065  13.996</span></span></code></pre></div>
<p>If you were not already using it, this is likely the time you would reach for the {data.table} package. Unfortunately the interval class created by {ivs} is built upon on the <a href="https://vctrs.r-lib.org/reference/new_rcrd.html" class="external-link">record type from vctrs</a>, and this class is not supported in {data.table}:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">DT</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/as.data.table.html" class="external-link">as.data.table</a></span><span class="op">(</span><span class="va">big_dat</span><span class="op">)</span></span>
<span><span class="va">DT</span><span class="op">[</span>, <span class="va">interval</span> <span class="op">:=</span> <span class="fu"><a href="https://davisvaughan.github.io/ivs/reference/iv.html" class="external-link">iv</a></span><span class="op">(</span><span class="va">start</span>, <span class="va">end</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="co">#&gt; Error in `[.data.table`(DT, , `:=`(interval, iv(start, end + 1))): Supplied 2 items to be assigned to 625000 items of column 'interval'. If you wish to 'recycle' the RHS please use rep() to make this intent clear to readers of your code.</span></span></code></pre></div>
<p>We can go through a few more steps to get a comparable answer but still find slightly slower performance:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fun</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">s</span>, <span class="va">e</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">interval</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://davisvaughan.github.io/ivs/reference/iv.html" class="external-link">iv</a></span><span class="op">(</span><span class="va">s</span>, <span class="va">e</span><span class="op">)</span></span>
<span>    <span class="va">groups</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://davisvaughan.github.io/ivs/reference/iv-groups.html" class="external-link">iv_groups</a></span><span class="op">(</span><span class="va">interval</span>, abutting <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>start <span class="op">=</span> <span class="fu"><a href="https://davisvaughan.github.io/ivs/reference/iv-accessors.html" class="external-link">iv_start</a></span><span class="op">(</span><span class="va">groups</span><span class="op">)</span>, end <span class="op">=</span> <span class="fu"><a href="https://davisvaughan.github.io/ivs/reference/iv-accessors.html" class="external-link">iv_end</a></span><span class="op">(</span><span class="va">groups</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="va">out_dt</span> <span class="op">&lt;-</span> <span class="va">DT</span><span class="op">[</span>, <span class="fu">fun</span><span class="op">(</span><span class="va">start</span>, <span class="va">end</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span>, by <span class="op">=</span> <span class="va">id</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt;    user  system elapsed </span></span>
<span><span class="co">#&gt;  14.972   0.022  14.984</span></span></code></pre></div>
<p><strong><em>NHSRepisodes</em></strong> solves this with the <code><a href="reference/merge_episodes.html">merge_episodes()</a></code> function:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/merge_episodes.html">merge_episodes</a></span><span class="op">(</span><span class="va">big_dat</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 334,767 × 4</span></span>
<span><span class="co">#&gt;       id .interval_number .episode_start .episode_end</span></span>
<span><span class="co">#&gt;    &lt;int&gt;            &lt;int&gt; &lt;date&gt;         &lt;date&gt;      </span></span>
<span><span class="co">#&gt;  1     1                1 2020-04-16     2020-06-23  </span></span>
<span><span class="co">#&gt;  2     2                1 2020-01-12     2020-02-22  </span></span>
<span><span class="co">#&gt;  3     2                2 2020-07-22     2020-08-16  </span></span>
<span><span class="co">#&gt;  4     2                3 2020-09-27     2021-01-11  </span></span>
<span><span class="co">#&gt;  5     3                1 2020-01-06     2020-03-02  </span></span>
<span><span class="co">#&gt;  6     3                2 2020-03-08     2020-03-16  </span></span>
<span><span class="co">#&gt;  7     3                3 2020-06-05     2020-08-26  </span></span>
<span><span class="co">#&gt;  8     4                1 2020-02-05     2020-05-03  </span></span>
<span><span class="co">#&gt;  9     4                2 2020-05-19     2020-09-08  </span></span>
<span><span class="co">#&gt; 10     5                1 2020-01-14     2020-03-13  </span></span>
<span><span class="co">#&gt; # ℹ 334,757 more rows</span></span>
<span></span>
<span><span class="co"># And for comparison with earlier timings</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/merge_episodes.html">merge_episodes</a></span><span class="op">(</span><span class="va">big_dat</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;    user  system elapsed </span></span>
<span><span class="co">#&gt;   0.917   0.000   0.335</span></span>
<span></span>
<span><span class="co"># equal output (subject to ordering)</span></span>
<span><span class="va">out</span> <span class="op">&lt;-</span> <span class="va">out</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>interval <span class="op">=</span> <span class="fu"><a href="https://davisvaughan.github.io/ivs/reference/iv.html" class="external-link">iv</a></span><span class="op">(</span>start <span class="op">=</span> <span class="va">.episode_start</span>, end <span class="op">=</span> <span class="va">.episode_end</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">id</span>, <span class="va">interval</span><span class="op">)</span></span>
<span></span>
<span><span class="va">out_dplyr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">out_dplyr</span>, <span class="va">id</span>, <span class="va">interval</span><span class="op">)</span></span>
<span></span>
<span><span class="va">out_dt</span> <span class="op">&lt;-</span> <span class="va">out_dt</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>interval <span class="op">=</span> <span class="fu"><a href="https://davisvaughan.github.io/ivs/reference/iv.html" class="external-link">iv</a></span><span class="op">(</span>start <span class="op">=</span> <span class="va">start</span>, end <span class="op">=</span> <span class="va">end</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">id</span>, <span class="va">interval</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">id</span>, <span class="va">interval</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="va">out</span>, <span class="va">out_dplyr</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="va">out</span>, <span class="va">out_dt</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
<p>We also provide another function <code><a href="reference/add_parent_interval.html">add_parent_interval()</a></code> that associates the the minimum spanning interval with each observation without reducing to the unique values:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/add_parent_interval.html">add_parent_interval</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 8 × 6</span></span>
<span><span class="co">#&gt;      id start      end        .parent_start .parent_end .interval_number</span></span>
<span><span class="co">#&gt;   &lt;int&gt; &lt;date&gt;     &lt;date&gt;     &lt;date&gt;        &lt;date&gt;                 &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1     1 2020-01-01 2020-01-10 2020-01-01    2020-01-10                 1</span></span>
<span><span class="co">#&gt; 2     1 2020-01-03 2020-01-10 2020-01-01    2020-01-10                 1</span></span>
<span><span class="co">#&gt; 3     2 2020-04-01 2020-04-30 2020-04-01    2020-04-30                 1</span></span>
<span><span class="co">#&gt; 4     2 2020-04-15 2020-04-16 2020-04-01    2020-04-30                 1</span></span>
<span><span class="co">#&gt; 5     2 2020-04-17 2020-04-19 2020-04-01    2020-04-30                 1</span></span>
<span><span class="co">#&gt; 6     1 2020-05-01 2020-10-01 2020-05-01    2020-10-01                 3</span></span>
<span><span class="co">#&gt; 7     1 2020-01-01 2020-01-10 2020-01-01    2020-01-10                 1</span></span>
<span><span class="co">#&gt; 8     1 2020-01-11 2020-01-12 2020-01-11    2020-01-12                 2</span></span></code></pre></div>
</div>
</div>
  </main><aside class="col-md-3"><div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php" class="external-link">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing NHSRepisodes</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Zoë Turner <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/0000-0003-1033-9158" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
<li>Tim Taylor <br><small class="roles"> Author </small> <a href="https://orcid.org/0000-0002-8587-7113" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
<li><a href="authors.html">More about authors...</a></li>
</ul>
</div>

<div class="dev-status">
<h2 data-toc-skip>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://lifecycle.r-lib.org/articles/stages.html#experimental" class="external-link"><img src="https://img.shields.io/badge/lifecycle-experimental-orange.svg" alt="Lifecycle: experimental"></a></li>
<li><a href="https://github.com/nhs-r-community/NHSRepisodes/actions/workflows/R-CMD-check.yaml" class="external-link"><img src="https://github.com/nhs-r-community/NHSRepisodes/actions/workflows/R-CMD-check.yaml/badge.svg" alt="R-CMD-check"></a></li>
</ul>
</div>

  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Zoë Turner, Tim Taylor.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
